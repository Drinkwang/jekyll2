---
layout:     post
title:      逆袭，从0开始解读Laya源代码
subtitle:   Laya的H5开发
date:       2020-11-02
author:     BYDrinker
header-img: img/post-bg-2015.png
catalog: true
tags:
    - 游戏开发，从0开始解读Laya源代码（0）
---


# 逆袭，从0开始解读Laya源代码（0）



* 今天我们来做一件很了不起的事情，那就是从零开始解读Laya的源代码，事情的起因是这样，我一直从事laya相关的工作，有一天我无聊的点开了laya的官方案例，竟发现了源码地址（你早该发现的），于是我二话不说克隆了一份到自己的电脑，经过一番研究过后，我发现只要了解ts/js以及nodejs相关的知识，看懂它的源代码也不是什么难事，所以，让我们开始吧..

首先值得我们参考的教程是这个...



> laya官方案例:https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-0-3-4





## 1.如何下载laya的引擎源码（编译流程）

### 1.下载源代码，编译并跑起程序

首先，我默认大家已经学会了Git以及laya ts的基本操作，想要了解Laya源代码的不可能对这些没有基本的了解吧，不会吧，不会吧...

当然就算你真的不了解，那我也不能放弃你，这里放出二个我认为不错的了解渠径



>  [廖雪峰的官方Git教程](https://www.liaoxuefeng.com/)  https://www.liaoxuefeng.com/wiki/896043488029600
>
>  [Laya的官方教程案例]( https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-0-3-0  )  https://ldc2.layabox.com/doc/?language=zh&nav=zh-ts-0-3-0  

看完这些（不看完跟着操作也没什么问题），我们就可以继续我们的源代码之旅拉。首先，我们需要clone Laya 在Github上面的官方示例。



> git clone  https://github.com/layabox/LayaAir 

当然我强烈建议你Fork一下它的项目，然后再克隆下自己仓库的，一方面你修改后能够储存到自己的仓库里，万一哪一天你的电脑因不可抗拒的原因放弃工作且无法治疗的时候，那么你换了新电脑也不会失去原来的工作进度，并且假如哪一天你的开发水平厉害了，能找到Bug并且反馈给开发组也是一件美事。



![image]({{ "/assets/Laya/fork.png" | absolute_url }})

接下来，我们通过 VSCode 打开这个项目，大概可以得到一个这样的目录。如果你的电脑没有安装，建议去官网进行下载..

 https://code.visualstudio.com/



下载好后，我们就可以打开工程来一探究竟了，我们应该会得到一个这样的目录



![image]({{ "/assets/Laya/dictionary.png" | absolute_url }})



是不是看起来很多目录，很多源码，很恐怖？？？

![image]({{ "/assets/Emoji/horrible.jpg" | absolute_url }})





但是不要方，我们可以逐步来分析，首先我们逐一结构一下引擎源码。来画出这样的思维导图...

![image]({{ "/assets/Laya/process.png" | absolute_url }})

- 我们看出这个引擎实际上是被划分成了许许多多的模块，而我们主要关注的则是这个layaAir的文件夹，引擎的具体实现都在这里，并且我们之后的修改也在这个中执行，不过现在提修改引擎有点过早了，我们先来编译下案例看看效果吧。

而Laya 案例编译有二种方法执行，第一种使用rollUp执行，第二种使用f5进行编译，我们这里会把二种方法都介绍下，大家只需要使用其中一种就好。

首先我们来装一下rollup，你需要先安装它

`  npm i rollup -g `



然后 执行 `rollup -c` 

 要注意的是，值得一提的是，如果这个环节报错，那么你可能npm还没有安装相关依赖，不管是f5模式，还是rollup 都需要执行这样的操作

` npm install`

并且如果首次采用rollup编译，编译四五分钟，甚至十几分钟，也是正常的，因电脑性能差异会有所不同，卡住了就多等会，不要直接终止。首次编译缓存后，以后编译就会快起来。

编译结束后，我们看到bin目录下的rollup示例相关的结构如下图所示。

![图](https://official.layabox.com/laya_data/LayaAir2.0/Chinese/FAQ/useGithub/img/8-3.png)

`bundle.js`是整合了引擎与示例的js库，`indexRollUp.html`是rollup调试模式的示例入口文件。

编译之后的运行，推荐采用anywhere启动一个本地的web服务。命令 `anywhere 端口号`，端口号自己定义，不冲突就行，参照如下图所示。

![图](https://official.layabox.com/laya_data/LayaAir2.0/Chinese/FAQ/useGithub/img/8-5.png)

> 如果本地装没有anywhere，可以安装下，命令： `npm i anywhere -g`

web服务运行起来之后。按命令行中的网址在chrome浏览器中访问，点开tsc编译模式或者rollup编译模式对应的html入口文件即可。

另外一种F5就比较简单了，因为laya源文件已经配置好了vscode tsc相关流程，执行完npm安装依赖的` npm install`，直接f5就好



###  2.小试牛刀，试图修改部分源代码逻辑

待续



## 2.接下来该怎么做

待续